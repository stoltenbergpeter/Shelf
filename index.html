
<head>
  <title>GloriFi Web Messaging Form Example</title>
  <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
  <base target="top">
  <style>
    .center {
      margin: auto;
      width: 40%;
      border: 3px solid #73AD21;
      padding: 10px;
    }
  </style>
  <script type="text/javascript" charset="utf-8">
    (function (g, e, n, es, ys) {
        g['_genesysJs'] = e;
        g[e] = g[e] || function () {
          (g[e].q = g[e].q || []).push(arguments)
        };
        g[e].t = 1 * new Date();
        g[e].c = es;
        ys = document.createElement('script'); 
        ys.async = 1; 
        ys.src = n; 
        ys.charset = 'utf-8'; 
        document.head.appendChild(ys);
      }
    )
    (window, 'Genesys', 'https://apps.usw2.pure.cloud/genesys-bootstrap/genesys.min.js', 
      {
        environment: 'usw2',
        deploymentId: 'd2e02e85-0cb2-412f-b918-8cabe5085fa8'
      }
    );
  </script>
  </head>
  <body style="font-family:Helvetica;">
  <h1>GloriFi Web Messaging Testing</h1>
  <table>
    <tr>
      <td colspan="2"><h3>Messenger Configuration</h3></td>
    </tr>
    <tr>
      <td>Deployment Name</td>
      <td>GloriFi</td>
    </tr>
    <tr>
      <td>Deployment Key</td>
      <td>d2e02e85-0cb2-412f-b918-8cabe5085fa8</td>
    </tr>
  </table>
  <br>
  <div id="datacollectionform" class="center">
  <table>
    <tr>
      <td colspan="2"><h3>Sample Data Collection Form</h3></td>
    </tr>
    <tr>
      <td>Choose Routing Key</td>
      <td>
        <select name="routekey" id="routingkey">
          <option value="General">General</option>
          <option value="Banking">Banking</option>
          <option value="Insurance">Insurance</option>
          <option value="Mortgage">Mortgage</option>
          <option value="Avtex">Avtex</option>
        </select>
    </td>
    </tr>
    <tr>
      <td>Full Name</td>
      <td><input type="text" id="fullname" name="fullname"></td>
    </tr>
    <tr>
      <td>Choose Topic</td>
      <td>
        <select name="topic" id="topic">
          <option value="Option 1">Option 1</option>
          <option value="Option 2">Option 2</option>
          <option value="Option 3">Option 3</option>
      </select>
    </td>
    </tr>
    <tr>
      <td></td>
      <td><button name="chatnow" id="chatnow" onclick="startWebMessaging()">Chat Now</button></td>
    </tr>
  </table>
  </div>
  
  <script type="text/javascript" charset="utf-8">
  let suppressMessenger = true;
  
  $( document ).ready(function() {
          console.log( "document loaded" );
  });
  
    // Subscribe to events
    Genesys("subscribe", "Messenger.opened", function(o){
      console.log("Messenger open event try to close window");
      
        if (suppressMessenger == true)
          {
            window.setTimeout(closeMessenger, 2000);
          }
  
    });
  
    // Try to close messenger window and hide launcher if visible
    function closeMessenger(){
      Genesys("command", "Messenger.close", {},
        function(o){
          console.log("Closed Messenger Window");
        },  // if resolved
        function(o){    // if rejected
          console.log("Failed Messenger Close");
          
        }
      );
    }
  
  // function to start a web message, send data to Genesys Cloud and disply Messenger window 
  function startWebMessaging() {
    var fullName = document.getElementById("fullname").value;
    var Topic = document.getElementById("topic").options[document.getElementById("topic").selectedIndex].value;
    var routingKey = document.getElementById("routingkey").options[document.getElementById("routingkey").selectedIndex].value;
  
    suppressMessenger = false;
  
    //Hide Data Collection Form
    document.getElementById("datacollectionform").style.display = "none";
  
    // Set Custom Attribute
    Genesys("command", "Database.set", {
                    messaging: {
                        customAttributes: {
                        "RoutingKey": routingKey,
                        "FullName": fullName,
                        "FinalIntent":Topic
                        }
                }
            });
  
      //Open Messanger Window
      Genesys("command", "Messenger.open");
  }
  </script>
  
  </body>
  </html>
